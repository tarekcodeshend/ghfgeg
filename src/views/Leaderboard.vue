<template>
    <div class="leaderboard">
        <div class="leaderboard-top">
            <div class="top-back">
                <div class="top-back-layout">
                    <div class="leaderboard-topback">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1062" height="277" viewBox="0 0 1062 277"
                            fill="none">
                            <path opacity="0.8" d="M1061.5 0H0.5L20.5 277H1041.5L1061.5 0Z"
                                fill="url(#paint0_linear_194_35)" />
                            <defs>
                                <linearGradient id="paint0_linear_194_35" x1="531" y1="0" x2="531" y2="277"
                                    gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#241D2E" stop-opacity="0" />
                                    <stop offset="1" stop-color="#1c2029" />
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="375" height="375" viewBox="0 0 375 375" fill="none">
                        <g opacity="0.06">
                            <path
                                d="M173.837 -0.000488281H201.163L187.732 187.5L201.163 375H173.837L187.732 187.5L173.837 -0.000488281Z"
                                fill="url(#paint0_radial_194_78)" />
                            <path
                                d="M246.63 9.04357L271.876 19.5006L187.714 187.588L128.37 365.955L103.124 355.498L187.714 187.588L246.63 9.04357Z"
                                fill="url(#paint1_radial_194_78)" />
                            <path
                                d="M103.124 19.5007L128.37 9.04362L187.714 187.411L271.876 355.498L246.63 365.956L187.714 187.411L103.124 19.5007Z"
                                fill="url(#paint2_radial_194_78)" />
                            <path
                                d="M45.2564 64.578L64.5785 45.2559L187.664 187.336L329.744 310.421L310.421 329.743L187.664 187.336L45.2564 64.578Z"
                                fill="url(#paint3_radial_194_78)" />
                            <path
                                d="M9.04399 128.369L19.501 103.124L187.589 187.286L365.956 246.63L355.499 271.875L187.589 187.286L9.04399 128.369Z"
                                fill="url(#paint4_radial_194_78)" />
                            <path
                                d="M1.19444e-06 201.162L0 173.837L187.5 187.268L375 173.837V201.162L187.5 187.268L1.19444e-06 201.162Z"
                                fill="url(#paint5_radial_194_78)" />
                            <path
                                d="M64.5785 329.743L45.2564 310.421L187.336 187.336L310.421 45.2559L329.743 64.578L187.336 187.336L64.5785 329.743Z"
                                fill="url(#paint6_radial_194_78)" />
                            <path
                                d="M19.501 271.875L9.04397 246.63L187.411 187.286L355.499 103.124L365.956 128.369L187.411 187.286L19.501 271.875Z"
                                fill="url(#paint7_radial_194_78)" />
                        </g>
                        <defs>
                            <radialGradient id="paint0_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint1_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint2_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint3_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint4_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint5_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint6_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                            <radialGradient id="paint7_radial_194_78" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                                gradientTransform="translate(187.5 187.5) rotate(90) scale(187.5)">
                                <stop offset="0.24" stop-color="#E5C900" />
                                <stop offset="1" stop-color="#E5C900" stop-opacity="0" />
                            </radialGradient>
                        </defs>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="1222" height="2" viewBox="0 0 1222 2" fill="none">
                        <path d="M1 1L1221 1.00011" stroke="url(#paint0_linear_194_106)" stroke-linecap="round"
                            style="mix-blend-mode:overlay" />
                        <path d="M1 1L1221 1.00011" stroke="url(#paint1_linear_194_106)" stroke-linecap="round"
                            style="mix-blend-mode:overlay" />
                        <defs>
                            <linearGradient id="paint0_linear_194_106" x1="1" y1="1.5" x2="1221" y2="1.50011"
                                gradientUnits="userSpaceOnUse">
                                <stop stop-color="white" stop-opacity="0" />
                                <stop offset="0.5" stop-color="white" />
                                <stop offset="1" stop-color="white" stop-opacity="0" />
                            </linearGradient>
                            <linearGradient id="paint1_linear_194_106" x1="1" y1="1.5" x2="1221" y2="1.50011"
                                gradientUnits="userSpaceOnUse">
                                <stop stop-color="white" stop-opacity="0" />
                                <stop offset="0.5" stop-color="white" />
                                <stop offset="1" stop-color="white" stop-opacity="0" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
            </div>
            <div class="leaderboard-countdown">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 29 29" fill="none">
                    <path
                        d="M27.1709 10.1941C27.7278 9.64279 28.1697 8.98639 28.471 8.26299C28.7723 7.53959 28.9271 6.76358 28.9262 5.97993C28.9262 2.69528 26.2594 0.0331642 22.9714 0.0326905H22.969C21.3203 0.0326905 19.8265 0.702602 18.7487 1.78469L22.2626 5.29296L21.471 6.09316C19.493 4.73431 17.1489 4.00835 14.7491 4.01142C12.3494 4.00818 10.0053 4.73398 8.02727 6.09269L7.17874 5.23469L10.6117 1.7629C10.0653 1.20457 9.41283 0.761017 8.69266 0.458286C7.97248 0.155555 7.19908 -0.000255569 6.41787 3.14662e-07C3.14933 3.14662e-07 0.5 2.67917 0.5 5.98419C0.5 7.64239 1.16612 9.14282 2.24395 10.2263L5.7129 6.71807L6.41171 7.42446C5.27076 8.54106 4.36471 9.87464 3.74691 11.3467C3.12911 12.8187 2.81205 14.3995 2.81437 15.9959C2.81437 18.3747 3.50749 20.5901 4.69761 22.4548L3.69843 28.4262H4.58248C5.1349 28.4262 5.33909 27.7776 5.69821 26.9708C6.01751 26.2467 6.33368 25.5212 6.6467 24.7943C8.7744 26.7728 11.6203 27.9823 14.7491 27.9823C17.8774 27.9823 20.7229 26.7718 22.8515 24.7943C23.1645 25.5213 23.4808 26.2468 23.8005 26.9708C24.1601 27.7776 24.3633 28.4262 24.9158 28.4262H25.7998L24.8021 22.4534C26.0339 20.5253 26.6871 18.2844 26.6843 15.9964C26.6867 14.4 26.3696 12.8193 25.7518 11.3474C25.134 9.8754 24.228 8.54191 23.087 7.42541L23.7389 6.76686L27.1709 10.1941ZM24.0322 15.9964C24.0322 21.1448 19.8758 25.3192 14.7491 25.3192C9.62245 25.3192 5.46654 21.1448 5.46654 15.9964C5.46654 10.8489 9.62198 6.67495 14.7491 6.67495C19.8753 6.67495 24.0322 10.8484 24.0322 15.9964Z"
                        fill="#646F8C" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M24.0322 15.9964C24.0322 21.1448 19.8758 25.3192 14.7491 25.3192C9.62245 25.3192 5.46654 21.1448 5.46654 15.9964C5.46654 10.8489 9.62198 6.67495 14.7491 6.67495C19.8753 6.67495 24.0322 10.8484 24.0322 15.9964ZM15.6327 9.33849V14.468C15.8982 14.6227 16.1186 14.8439 16.2723 15.11H19.1694V16.8852H16.2723C15.9653 17.4139 15.402 17.773 14.7491 17.773C14.4483 17.773 14.1688 17.6906 13.9214 17.5579L9.85792 21.6669L9.30834 21.1098L13.3278 17.0458C13.1122 16.7516 12.981 16.3906 12.981 15.9969C12.9816 15.6869 13.0636 15.3826 13.2187 15.1143C13.3739 14.846 13.5968 14.6231 13.8651 14.468V9.33849H15.6327Z"
                        fill="#646F8C" />
                </svg>
                <div class="countdown-title">LEADERBOARD ENDS</div>
                <div class="countdown-content"><span data-v-10e51aa4="">{{ leaderboardTimer.split(':')[0] }}</span>D
                    <span data-v-10e51aa4="">{{ leaderboardTimer.split(':')[1] }}</span>H <span data-v-10e51aa4="">{{
                        leaderboardTimer.split(':')[2] }}</span>M <span data-v-10e51aa4="">{{
                            leaderboardTimer.split(':')[3] }}</span>S
                </div>
            </div>
            <transition name="fade" mode="out-in">
                <div v-if="leaderboardData.loading === true" class="leaderboard-podium" key="loading">
                    <LeaderboardPodiumElement :position="'#2'" :winner="null" />
                    <LeaderboardPodiumElement :position="'#1'" :winner="null" />
                    <LeaderboardPodiumElement :position="'#3'" :winner="null" />
                </div>
                <div v-else-if="leaderboardData.data !== null && leaderboardData.data.winners.length > 2" class="leaderboard-podium" key="data">

                    <LeaderboardPodiumElement v-bind:key="2"
                        v-bind:position="`#2`" v-bind:winner="leaderboardData.data.winners[1]" />                  
                    <LeaderboardPodiumElement v-bind:key="1"
                        v-bind:position="`#1`" v-bind:winner="leaderboardData.data.winners[0]" />                  
                    <LeaderboardPodiumElement v-bind:key="3"
                        v-bind:position="`#3`" v-bind:winner="leaderboardData.data.winners[2]" />                  

                </div>
                <div v-else class="leaderboard-podium" key="empty">

                    <LeaderboardPodiumElement v-bind:key="2"
                        v-bind:position="`#2`" v-bind:winner="null" />                  
                    <LeaderboardPodiumElement v-bind:key="1"
                        v-bind:position="`#1`" v-bind:winner="null" />                  
                    <LeaderboardPodiumElement v-bind:key="3"
                        v-bind:position="`#3`" v-bind:winner="null" />                  

                </div>
            </transition>
        </div>
        <div class="leaderboard-users">
            <div class="users-header">
                <div class="header-element element-rank">RANK</div>
                <div class="header-element element-user">USER</div>
                <div class="header-element element-wagered">WAGERED</div>
                <div class="header-element element-prize">PRIZE</div>
            </div>
            <div class="users-list">
                <transition name="fade" mode="out-in">
                    <div v-if="leaderboardData.loading === true" class="content-loading" key="loading">
                        <LoadingAnimation />
                    </div>
                    <div v-else-if="leaderboardData.data !== null && leaderboardData.data.winners.length > 3" class="content-list" key="data">

                        <LeaderboardUserElement v-for="(winner, index) of leaderboardData.data.winners.slice(3)"
                            v-bind:key="index" v-bind:position="`#${index + 4}`" v-bind:winner="winner" />

                    </div>
                    <div v-else class="list-empty" key="empty">No leaderboard found.</div>
                </transition>
            </div>
        </div>
    </div>
</template>

<script>
import { mapGetters, mapActions } from 'vuex';
import IconTimer from '@/components/icons/IconTimer';
import LoadingAnimation from '@/components/LoadingAnimation';
import AvatarImage from '@/components/AvatarImage';
import LeaderboardUserElement from '@/components/leaderboard/LeaderboardUserElement';
import LeaderboardPodiumElement from '@/components/leaderboard/LeaderboardPodiumElement';

export default {
    name: 'Leaderboard',
    metaInfo: {
        title: 'Leaderboard - STARFlip.live'
    },
    components: {
        IconTimer,
        LoadingAnimation,
        AvatarImage,
        LeaderboardUserElement,
        LeaderboardPodiumElement
    },
    data() {
        return {
            leaderboardTimerInterval: null,
            leaderboardTimer: '00:00:00:00'
        }
    },
    methods: {
        ...mapActions([
            'leaderboardGetDataSocket'
        ]),
        leaderboardStartTimer() {
            const endingTime = new Date(this.leaderboardData.data.updatedAt).getTime() + (1000 * 60 * 60 * 24 * Number(this.leaderboardData.data.duration));
            let timeLeft = Math.floor((endingTime - (new Date().getTime() + this.generalTimeDiff)) / 1000);
            timeLeft = timeLeft <= 0 ? 0 : timeLeft;

            let timeDays = Math.floor(timeLeft / (60 * 60 * 24));
            timeDays = timeDays < 10 ? '0' + timeDays : timeDays;
            let timeHours = Math.floor((timeLeft % (60 * 60 * 24)) / (60 * 60));
            timeHours = timeHours < 10 ? '0' + timeHours : timeHours;
            let timeMinutes = Math.floor((timeLeft % (60 * 60)) / 60);
            timeMinutes = timeMinutes < 10 ? '0' + timeMinutes : timeMinutes;
            let timeSeconds = Math.floor(timeLeft % 60);
            timeSeconds = timeSeconds < 10 ? '0' + timeSeconds : timeSeconds;

            this.leaderboardTimer = timeDays.toString() + ':' + timeHours.toString() + ':' + timeMinutes.toString() + ':' + timeSeconds.toString();
        }
    },
    computed: {
        ...mapGetters([
            'generalTimeDiff',
            'leaderboardData'
        ])
    },
    watch: {
        'leaderboardData.data': {
            handler() {
                if (this.leaderboardData.data !== null) {
                    clearInterval(this.leaderboardTimerInterval);
                    this.leaderboardTimerInterval = setInterval(() => { this.leaderboardStartTimer(); }, 1000);
                }
            },
            deep: true
        }
    },
    created() {
        if (this.leaderboardData.loading === false) {
            const data = {};
            this.leaderboardGetDataSocket(data);
        }
    }
}
</script>

<style scoped>
.leaderboard-top {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    padding-bottom: 30px;
}

.leaderboard-top .top-back {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    padding: 0px 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 0;
}

.leaderboard-top .top-back .top-back-layout {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.leaderboard-top .top-back .top-back-layout .leaderboard-topback {
    position: absolute;
    bottom: 0px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    justify-content: center;
    align-items: center;
}

.leaderboard-user-element {
    width: 100%;
    height: 48px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 40px;
    background: #241D2E;
    background-blend-mode: overlay;
    border-radius: 8px;
}

.leaderboard-user-element .element-section {
    display: flex;
    flex-direction: column
}

.leaderboard-user-element .element-section.section-rank {
    width: 10%
}

.leaderboard-user-element .element-section.section-user {
    width: 50%
}

.leaderboard-user-element .element-section.section-prize,
.leaderboard-user-element .element-section.section-wagered {
    width: 20%
}

.leaderboard-user-element .section-title {
    display: none;
    font-size: 12px;
    font-weight: 700;
    color: #767c8b
}

.leaderboard-user-element .section-content {
    display: flex;
    align-items: center
}

.leaderboard-user-element .element-section.section-rank .section-content,
.leaderboard-user-element .element-section.section-user .section-content {
    font-size: 15px;
    font-weight: 700;
    color: #fff
}

.leaderboard-user-element .element-section.section-prize .section-content {
    justify-content: flex-end
}

.leaderboard-user-element .avatar-image {
    width: 24px;
    height: 24px;
    margin-right: 12px;
    border-radius: 5px
}

.leaderboard-user-element .element-section.section-prize .section-content img,
.leaderboard-user-element .element-section.section-wagered .section-content img {
    width: 21px;
    margin-right: 10px
}

.leaderboard-user-element .content-value {
    font-size: 12px;
    font-weight: 700;
    color: #bbb
}

.leaderboard-user-element .element-section.section-prize .content-value {
    color: #00c74d
}

.leaderboard-user-element .content-value span {
    font-size: 15px;
    font-weight: 700;
    color: #fff
}

.leaderboard-user-element .element-section.section-prize .content-value span {
    color: #00c74d
}

@media only screen and (max-width: 900px) {
    .leaderboard-user-element {
        height: auto;
        flex-direction: column;
        align-items: flex-start;
        padding: 10px 20px
    }

    .leaderboard-user-element .element-section {
        width: 100% !important;
        margin-top: 10px
    }

    .leaderboard-user-element .element-section.section-rank {
        margin-top: 0
    }

    .leaderboard-user-element .element-section.section-prize {
        align-items: flex-start
    }

    .leaderboard-user-element .section-title {
        display: block
    }

    .leaderboard-user-element .section-content {
        margin-top: 5px
    }
}

.leaderboard {
    width: 1300px;
    min-height: calc(100vh - 112px);
    padding: 40px
}

.leaderboard .leaderboard-countdown {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center
}

.leaderboard .countdown-title {
    font-size: 12px;
    font-weight: 600;
    color: #646F8C
}

.leaderboard .countdown-content {
    font-size: 20px;
    font-weight: 700;
    color: #fff
}

.leaderboard .leaderboard-podium {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin-top: 25px;
    z-index: 1;
}

.leaderboard .leaderboard-users {
    width: 100%;
    margin-top: 40px;
    padding: 15px;
    border-radius: 8px;
    background: #1c2029;
}

.leaderboard .users-header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 40px;
}

.leaderboard .header-element {
    font-size: 12px;
    font-weight: 700;
    color: #CABFDD
}

.leaderboard .header-element.element-rank {
    width: 10%;
    display: flex;
    /* justify-content: center; */
}

.leaderboard .header-element.element-user {
    width: 60%
}

.leaderboard .header-element.element-prize,
.leaderboard .header-element.element-wagered {
    width: 15%;
    display: flex;
    justify-content: flex-end;
}

.leaderboard .header-element.element-prize {
    display: flex;
    justify-content: flex-end
}

.leaderboard .users-list {
    width: 100%;
    margin-top: 8px
}

.leaderboard .content-loading {
    width: 100%;
    height: 192px;
    display: flex;
    justify-content: center;
    align-items: center
}

.leaderboard .content-loading.fade-leave-active {
    transition: opacity .5s
}

.leaderboard .content-loading.fade-leave-to {
    opacity: 0
}

.leaderboard .list-data {
    width: 100%
}

.leaderboard .list-empty {
    width: 100%;
    height: 192px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-transform: uppercase;
    font-size: 12px;
    font-weight: 700;
    color: #CABFDD
}

.leaderboard .list-data.fade-enter-active,
.leaderboard .list-empty.fade-enter-active {
    transition: opacity .5s
}

.leaderboard .list-data.fade-enter-from,
.leaderboard .list-empty.fade-enter-from {
    opacity: 0
}

@media only screen and (max-width: 1330px) {
    .leaderboard {
        width: 100%;
        padding: 20px 10px
    }
}

@media only screen and (max-width: 900px) {
    .leaderboard .leaderboard-users {
        padding: 10px
    }

    .leaderboard .users-header {
        display: none
    }

    .leaderboard .users-list {
        width: 100%;
        margin-top: 0
    }
}

@media only screen and (max-width: 650px) {
    .leaderboard .leaderboard-podium {
        display: grid;
        grid-template-columns: 50% 50%;
        grid-template-rows: auto auto;
        grid-gap: 15px;
        margin-top: 15px;
    }

    .leaderboard-top .top-back {
        padding: 0px;    
    }
}
</style>
